<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Wetterdaten</title>
    <link rel="stylesheet" href="jquery-jvectormap-2.0.5.css" type="text/css" media="screen"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="jquery-jvectormap-2.0.5.min.js"></script>
    <script src="jquery-jvectormap-de-merc.js"></script>
    <script src="jquery-jvectormap-europe-merc.js"></script>
    <style>

        .map {
            width: available;
            height: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .flex-container {
            display: flex;
            flex-wrap: wrap;
        }

        .mapBox {
            width: 33%;
            display: flow;
            margin-right: auto;
            margin-left: auto
        }

        .mapScale {
            display: flex;
            width: available;
            margin-left: auto;
            margin-right: auto;
            padding-top: 5px
        }

        .mapScale > div {
            margin-left: auto;
            margin-right: auto
        }

        .mapScale > div > div {
            width: 6.25%;
            height: 30px;
            margin-left: auto;
            margin-right: auto
        }

        .playButton {
            margin-left: auto;
            margin-right: auto;
            display: block;
            font-size: 150%;
            height: 40px;
            width: 40px;
        }

        .jvectormap-region {
            stroke: black;
            stroke-width: 1.5;
        }

        .slidecontainer {
            display: flex;
        }

        .slider {
            -webkit-appearance: none;
            margin: auto 2% auto auto;
            float: right;
            height: 15px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #1E90FF;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #1E90FF;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="flex-container">
    <a href="GermanMapAnnual.html" style="margin: auto">Jährliche Kenntage deutscher Bundesländer</a>
    <a href="GermanMapMonthly.html" style="margin: auto">Monatliche Mittelwerte deutscher Bundesländer</a>
    <a href="EuropeMap.html" style="margin: auto">Monatliche Temperaturen europäischer Hauptstädte</a>
</div>
<h1 style="text-align:center">Monatliche Temperaturen europäischer Hauptstädte</h1>

<div class="flex-container">
    <div id="mapBox-0" class="mapBox">
        <div>
            <div id="map-0" class="map"></div>
        </div>
        <div class="mapScale">
            <div style="margin-top: auto; margin-bottom: auto"><span id="mapScaleMin-0">1</span>°C</div>
            <div style="width: 64%; display: flex">
                <div style="background-color: #0000ff"></div>
                <div style="background-color: #1100ee"></div>
                <div style="background-color: #2200dd"></div>
                <div style="background-color: #3300cc"></div>
                <div style="background-color: #4400bb"></div>
                <div style="background-color: #5500aa"></div>
                <div style="background-color: #660099"></div>
                <div style="background-color: #770088"></div>
                <div style="background-color: #880077"></div>
                <div style="background-color: #990066"></div>
                <div style="background-color: #aa0055"></div>
                <div style="background-color: #bb0044"></div>
                <div style="background-color: #cc0033"></div>
                <div style="background-color: #dd0022"></div>
                <div style="background-color: #ee0011"></div>
                <div style="background-color: #ff0000"></div>
            </div>
            <div style="margin-top: auto; margin-bottom: auto"><span id="mapScaleMax-0">100</span>°C</div>
        </div>
    </div>
</div>

<div class="slidecontainer">
    <p style="margin-left: 2%; font-size:150%">Monat: <span id="month"></span></p>
    <input style="width: 50%; margin-right: 17%" type="range" min="0" max="11" value="0" class="slider"
           id="monthsSlider">
</div>

<div class="slidecontainer">
    <p style="margin-left: 2%; font-size:150%">Jahr: <span id="year"></span></p>
    <input style="width: 80%" type="range" min="1881" max="2025" value="2000" class="slider" id="yearsSlider">
</div>
<button class="playButton" id="playButton">&#9658;</button>
<p style="text-align:center">Gruppe: Fabian Böttcher, Laura Haase, Ruben Niederhoff</p>

<script>
    $.ajax({
        type: "GET",
        url: "http://localhost:3000/europe",
        success: function (data) {
            // split the string back into the different csv files
            var csvData = data.split("|");
            processData(csvData);
        }
    });

    var currentYear = 2000;
    var currentMonth = 0;
    var csvFile = [];
    var colorScale = [];
    var valueScale = [];

    function processData(csvData) {
        var minValue = Number.MAX_VALUE;
        var maxValue = Number.MIN_VALUE;
        var maxLength = 0;
        for (var i = 0; i < csvData.length; i++) {
            var length = csvData[i].split(/\r\n|\n/).length;
            if (length > maxLength) {
                maxLength = length;
            }
        }
        for (var i = 0; i < maxLength; i++) {
            csvFile.push([]);
        }
        console.log(maxLength);
        for (var i = 0; i < csvData.length; i++) {
            var allTextLines = csvData[i].split(/\r\n|\n/);

            var emptyLines = maxLength - allTextLines.length;
            for (var j = 0; j < emptyLines; j++) {
                csvFile[j].push(null);
            }

            for (var j = 1; j < allTextLines.length; j++) {
                var value = allTextLines[j].split(',')[1];
                csvFile[emptyLines + j - 1].push(value);
                var tempFloat = parseFloat(value);
                if (tempFloat < minValue) {
                    minValue = tempFloat;
                }
                if (tempFloat > maxValue) {
                    maxValue = tempFloat;
                }
            }
        }
        calculateValues(minValue, maxValue);
        calculateColorScale();
        console.log(csvFile);
        paintMap(currentYear, currentMonth);
    }

    function calculateValues(minValue, maxValue) {
        maxValue = Math.ceil(maxValue*2)/2;
        var difference = maxValue - minValue;
        for (var i = 0; i < 16; i++) {
            valueScale[i] = minValue + difference * i / 15;
        }
        document.getElementById("mapScaleMin-0").innerText = minValue;
        document.getElementById("mapScaleMax-0").innerText = maxValue;
    }

    function calculateColorScale() {
        for (var i = 0; i < 16; i++) {
            colorScale[i] = "rgb(" + (17 * i) + "," + 0 + "," + (255 - 17 * i) + ")"
        }
    }

    function paintMap(year, month) {
        var temperatures = csvFile[(year - 1881) * 12 + month];
        var stateColoring = {};
        var i;
        if (temperatures[0] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[0] <= valueScale[i]) {
                    stateColoring["AT"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["AT"] = "rgb(180, 180, 180)";
        }
        if (temperatures[1] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[1] <= valueScale[i]) {
                    stateColoring["BY"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["BY"] = "rgb(180, 180, 180)"
        }
        if (temperatures[2] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[2] <= valueScale[i]) {
                    stateColoring["BE"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["BE"] = "rgb(180, 180, 180)"
        }
        if (temperatures[3] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[3] <= valueScale[i]) {
                    stateColoring["BA"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["BA"] = "rgb(180, 180, 180)"
        }
        if (temperatures[4] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[4] <= valueScale[i]) {
                    stateColoring["BG"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["BG"] = "rgb(180, 180, 180)"
        }
        if (temperatures[5] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[5] <= valueScale[i]) {
                    stateColoring["HR"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["HR"] = "rgb(180, 180, 180)"
        }
        if (temperatures[6] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[6] <= valueScale[i]) {
                    stateColoring["CZ"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["CZ"] = "rgb(180, 180, 180)"
        }
        if (temperatures[7] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[7] <= valueScale[i]) {
                    stateColoring["DK"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["DK"] = "rgb(180, 180, 180)"
        }
        if (temperatures[8] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[8] <= valueScale[i]) {
                    stateColoring["EE"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["EE"] = "rgb(180, 180, 180)"
        }
        if (temperatures[9] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[9] <= valueScale[i]) {
                    stateColoring["FI"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["FI"] = "rgb(180, 180, 180)"
        }
        if (temperatures[10] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[10] <= valueScale[i]) {
                    stateColoring["FR"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["FR"] = "rgb(180, 180, 180)"
        }
        if (temperatures[11] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[11] <= valueScale[i]) {
                    stateColoring["DE"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["DE"] = "rgb(180, 180, 180)"
        }
        if (temperatures[12] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[12] <= valueScale[i]) {
                    stateColoring["GR"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["GR"] = "rgb(180, 180, 180)"
        }
        if (temperatures[13] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[13] <= valueScale[i]) {
                    stateColoring["HU"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["HU"] = "rgb(180, 180, 180)"
        }
        if (temperatures[14] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[14] <= valueScale[i]) {
                    stateColoring["IS"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["IS"] = "rgb(180, 180, 180)"
        }
        if (temperatures[15] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[15] <= valueScale[i]) {
                    stateColoring["IE"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["IE"] = "rgb(180, 180, 180)"
        }
        if (temperatures[16] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[16] <= valueScale[i]) {
                    stateColoring["IT"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["IT"] = "rgb(180, 180, 180)"
        }
        if (temperatures[17] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[17] <= valueScale[i]) {
                    stateColoring["LV"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["LV"] = "rgb(180, 180, 180)"
        }
        if (temperatures[18] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[18] <= valueScale[i]) {
                    stateColoring["LT"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["LT"] = "rgb(180, 180, 180)"
        }
        if (temperatures[19] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[19] <= valueScale[i]) {
                    stateColoring["LU"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["LU"] = "rgb(180, 180, 180)"
        }
        if (temperatures[20] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[20] <= valueScale[i]) {
                    stateColoring["MT"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["MT"] = "rgb(180, 180, 180)"
        }
        if (temperatures[21] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[21] <= valueScale[i]) {
                    stateColoring["ME"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["ME"] = "rgb(180, 180, 180)"
        }
        if (temperatures[22] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[22] <= valueScale[i]) {
                    stateColoring["NL"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["NL"] = "rgb(180, 180, 180)"
        }
        if (temperatures[23] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[23] <= valueScale[i]) {
                    stateColoring["NO"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["NO"] = "rgb(180, 180, 180)"
        }
        if (temperatures[24] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[24] <= valueScale[i]) {
                    stateColoring["PL"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["PL"] = "rgb(180, 180, 180)"
        }
        if (temperatures[25] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[25] <= valueScale[i]) {
                    stateColoring["PT"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["PT"] = "rgb(180, 180, 180)"
        }
        if (temperatures[26] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[26] <= valueScale[i]) {
                    stateColoring["RO"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["RO"] = "rgb(180, 180, 180)"
        }
        if (temperatures[27] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[27] <= valueScale[i]) {
                    stateColoring["RU"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["RU"] = "rgb(180, 180, 180)"
        }
        if (temperatures[28] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[28] <= valueScale[i]) {
                    stateColoring["CH"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["CH"] = "rgb(180, 180, 180)"
        }
        if (temperatures[29] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[29] <= valueScale[i]) {
                    stateColoring["RS"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["RS"] = "rgb(180, 180, 180)"
        }
        if (temperatures[30] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[30] <= valueScale[i]) {
                    stateColoring["SK"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["SK"] = "rgb(180, 180, 180)"
        }
        if (temperatures[31] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[31] <= valueScale[i]) {
                    stateColoring["ES"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["ES"] = "rgb(180, 180, 180)"
        }
        if (temperatures[32] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[32] <= valueScale[i]) {
                    stateColoring["SE"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["SE"] = "rgb(180, 180, 180)"
        }
        if (temperatures[33] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[33] <= valueScale[i]) {
                    stateColoring["UA"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["UA"] = "rgb(180, 180, 180)"
        }
        if (temperatures[34] != null) {
            for (i = 0; i < valueScale.length; i++) {
                if (temperatures[34] <= valueScale[i]) {
                    stateColoring["GB"] = colorScale[i];
                    break;
                }
            }
        } else {
            stateColoring["GB"] = "rgb(180, 180, 180)"
        }
        $("#map-0").vectorMap("get", "mapObject").series.regions[0].setValues(stateColoring);
    }

    $("#map-0").vectorMap({
        map: "europe_merc",
        backgroundColor: '#FFFFFF',
        series: {
            regions: [{
                values: []
            }]
        }
    });

    var yearsSlider = document.getElementById("yearsSlider");
    var yearsOutput = document.getElementById("year");
    yearsOutput.innerHTML = yearsSlider.value;

    yearsSlider.oninput = function () {
        currentYear = Number(this.value);
        if (this.value >= 2021) {
            yearsOutput.innerHTML = this.value + " (Vorhersage)";
            monthsOutput.innerHTML = months[currentMonth] + " (Vorhersage)";
        } else {
            yearsOutput.innerHTML = this.value;
            monthsOutput.innerHTML = months[currentMonth];
        }
        paintMap(currentYear, currentMonth);
    }

    var monthsSlider = document.getElementById("monthsSlider");
    var monthsOutput = document.getElementById("month");
    var months = ["Januar", "Februar", "März", "April", "Mai", "Juni", "Juli", "August", "September", "Oktober", "November", "Dezember"];
    monthsOutput.innerHTML = months[monthsSlider.value];

    monthsSlider.oninput = function () {
        currentMonth = Number(this.value);
        if (currentYear >= 2021) {
            monthsOutput.innerHTML = months[this.value] + " (Vorhersage)";
        } else {
            monthsOutput.innerHTML = months[this.value];
        }
        paintMap(currentYear, currentMonth);
    }

    var play = false;
    var playButton = document.getElementById("playButton");
    playButton.onclick = function () {
        if (playButton.innerHTML === "►") {
            playButton.innerHTML = "&#10073;&#10073;"
            play = true;
            oneStep();
        } else {
            play = false;
            playButton.innerHTML = "&#9658;";
        }
    }

    // step through the months and years;
    function oneStep() {
        if (play === true && (currentYear <= 2025 || currentMonth < 11)) {
            if (currentMonth < 11) {
                monthsSlider.value = ++currentMonth;
                monthsSlider.dispatchEvent(new Event("input", {bubbles: true}));
            } else {
                currentMonth = 0;
                monthsSlider.value = currentMonth;
                yearsSlider.value = ++currentYear;
                yearsSlider.dispatchEvent(new Event("input", {bubbles: true}));
            }
            setTimeout(oneStep, 500)
        } else {
            playButton.innerHTML = "&#9658;";
            play = false;
        }
    }
</script>
</body>
</html>